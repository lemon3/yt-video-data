/*!
* YTVideoData v0.1.0
* https://github.com/lemon3/yt-video-data
*/
(function(a,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(a=typeof globalThis!="undefined"?globalThis:a||self,i(a.YTVideoData={}))})(this,function(a){"use strict";var b=Object.defineProperty,_=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var f=(a,i,s)=>i in a?b(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s,m=(a,i)=>{for(var s in i||(i={}))T.call(i,s)&&f(a,s,i[s]);if(g)for(var s of g(i))I.call(i,s)&&f(a,s,i[s]);return a},v=(a,i)=>_(a,P(i));var n=(a,i,s)=>f(a,typeof i!="symbol"?i+"":i,s);var y=(a,i,s)=>new Promise((c,l)=>{var h=e=>{try{r(s.next(e))}catch(t){l(t)}},u=e=>{try{r(s.throw(e))}catch(t){l(t)}},r=e=>e.done?c(e.value):Promise.resolve(e.value).then(h,u);r((s=s.apply(a,i)).next())});const i=r=>{if(/^[a-zA-Z0-9_-]{11}$/.test(r))return r;{const e=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,t=r.match(e);return t&&t[7]&&t[7].length===11?t[7]:!1}},s=(r,e=window.document)=>{const t=e.createElement("script");t.src=r;const o=e.getElementsByTagName("script")[0];o&&o.parentNode?o.parentNode.insertBefore(t,o):e.body.append(t)},c={width:"160",height:"90",playerVars:{playsinline:0,autoplay:0,enablejsapi:0,iv_load_policy:3,controls:0,disablekb:1,showinfo:0,rel:0,fs:0}},l="youtube-api-ready",h="https://www.youtube.com/iframe_api";class u{constructor(){n(this,"div");n(this,"wrapper");n(this,"ready");n(this,"player");n(this,"promise");n(this,"videoId","");n(this,"yt");n(this,"_stateChange",({data:e})=>{this.promise&&e===1&&(this.player.mute().stopVideo().clearVideo(),this.promise.resolve(this._createData()))});n(this,"_playerReady",()=>{this.ready=!0,this.player.mute(),this.player.setVolume(0)});const e=document.createElement("div");e.style.position="absolute",e.style.left="-200vw",e.style.opacity="0",e.style.visibility="hidden",this.div=document.createElement("div"),e.append(this.div),document.body.append(e),this.wrapper=e,this.ready=!1,this.init()}_createData(){const e=this.player.playerInfo;let t=e.videoData.author;return t=t.replace("- Topic","").trim(),{title:this.player.videoTitle||e.videoData.title,author:t,videoId:e.videoData.video_id,videoUrl:e.videoUrl,duration:e.duration,poster:this.getPoster()}}_load(e){return y(this,null,function*(){return new Promise((t,o)=>{this.player.loadVideoById(e),this.promise={resolve:t,reject:o}})})}getInfo(e){return y(this,null,function*(){const t=i(e);return this.promise=null,console.log(e,t),new Promise((o,d)=>{t?e=t:d("not a valid video id or url"),this.videoId=e;const w=setInterval(()=>y(this,null,function*(){if(this.ready){clearInterval(w);const p=yield this._load(e);o(p)}}),20)})})}_loadAPI(){return y(this,null,function*(){return new Promise((e,t)=>{if(window.YT)return e(window.YT);const o=p=>{if(window.removeEventListener(l,d),p)return e(p);t(new Error("Failed to load YouTube API"))},d=p=>o(p.target.YT),w=new Event(l);window.addEventListener(l,d),window.onYouTubeIframeAPIReady=()=>{window.dispatchEvent(w)},s(h)})})}_createPlayer(){this.player=new this.yt.Player(this.div,v(m({},c),{videoId:"dQw4w9WgXcQ",events:{onReady:this._playerReady,onStateChange:this._stateChange}}))}getPoster(e=this.videoId){const t=`https://i.ytimg.com/vi/${e}/`;return["default","hqdefault","mqdefault","sddefault","maxresdefault","hq720"].reduce((o,d)=>v(m({},o),{[d]:`${t}${d}.jpg`}),{})}destroy(){this.yt&&(this.yt.destroy(),this.wrapper.remove())}init(){if(window.YT){this.yt=window.YT,this._createPlayer();return}y(this,null,function*(){this.yt=yield this._loadAPI(),this._createPlayer()})}}a.YTVideoData=u,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
